<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://mechsix.github.io/blog</id>
    <title>Mech Tsai Blog</title>
    <updated>2024-06-05T16:01:10.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://mechsix.github.io/blog"/>
    <subtitle>Mech Tsai Blog</subtitle>
    <icon>https://mechsix.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[一天24小時？談DateTime處理]]></title>
        <id>https://mechsix.github.io/blog/一天24小時？談DateTime處理</id>
        <link href="https://mechsix.github.io/blog/一天24小時？談DateTime處理"/>
        <updated>2024-06-05T16:01:10.000Z</updated>
        <summary type="html"><![CDATA[概述]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E6%A6%82%E8%BF%B0" class="hash-link" aria-label="Direct link to 概述" title="Direct link to 概述">​</a></h2>
<p>DateTime的處理，在開發應用程式時很常見，但身為開發者一陣子，總有那麼幾次會栽在DateTime的處理問題上。就日期來說，年要潤與不潤，月是大月小月，這雖然都有一定規則可循，但其中的複雜度在開發應用程式時有時程壓力下，要能夠處理得好也不是太容易的事。</p>
<p>本文會以Web Application為範例，簡述幾個DateTime處理上可能遇到的問題，及處理方式。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="問題">問題<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E5%95%8F%E9%A1%8C" class="hash-link" aria-label="Direct link to 問題" title="Direct link to 問題">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="一天24小時">一天24小時<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82" class="hash-link" aria-label="Direct link to 一天24小時" title="Direct link to 一天24小時">​</a></h3>
<p>再簡單不過不是？但是在現在電腦系統中廣泛使用的<a href="https://zh.wikipedia.org/wiki/%E6%A0%BC%E9%87%8C%E6%9B%86" target="_blank" rel="noopener noreferrer">格里曆</a>，處理小時與日期轉換時是否可以將一天當作24小時來處理？</p>
<p>舉個例子來說，開發一個部落格系統，在「最新文章」的區塊要在畫面上顯示過去一天新發表的文章。大概會像這樣</p>
<!-- -->
<ol>
<li>由前端向後端發起請求</li>
<li>後端收到請求時以server的時間為準取得當下時間Now作為lte(less than or equal)</li>
<li>拿lte減去24hr作為gte (greater than or equal)</li>
</ol>
<p>以Javascript前後端，接上MongoDB寫起來大概是這樣</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">frontend.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http://backend.com/latest-posts'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'target-pre'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">html</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">backend.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> endTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> starTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> posts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token maybe-class-name">Post</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">createdAt</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">$gte</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">startTime</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">getFullYear</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">startTime</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">getMonth</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">startTime</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">getDate</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> 00:00:00</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">$lte</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">endTime</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">getFullYear</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">endTime</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">getMonth</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">endTime</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">getDate</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> 00:00:00</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>寫過一陣子Web Application的工程師大多能做得出來。過程中也做了些安全上的保護：</p>
<ol>
<li><code>endTime</code>是由Server決定的，所以不會受到前端使用者本地時間的影響，所以這隻程式不需擔心使用者電腦校時有沒有問題</li>
<li>接著拿<code>endTime</code>減去24hr取得gte，去跟資料庫拿出這個區間的資料回給前端顯示在畫面上。所有往資料庫的輸入都是同一台機器，也就是後端決定的，也沒有被XSS或SQL inject等安全疑慮</li>
</ol>
<p><strong>但其實這隻程式在很多國家，一年會壞個兩次</strong></p>
<p>在有實行日光節約的國家(e.g. 美國)，每年有個兩天並不是24小時。</p>
<p>例如以2021年來說，在美國東部標準時間(EST)為例子</p>
<ul>
<li>Mar 14, 2021 01:59:59 的下一秒鐘是 03:00:00，日光節約結束</li>
<li>Nov 7, 2021 02:59:59 的下一秒鐘是 02:00:00，日光節約開始</li>
</ul>
<p>於是在2021年的EST Timezone，Mar 14只有23小時，而Nov 7卻有25個小時。只要你的程式被執行的當下，往前算24小時會經過這個被切換的小時的話，被從資料庫抓出來的資料就會多或少一個小時的資料。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dmy與ymd">DMY與YMD<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#dmy%E8%88%87ymd" class="hash-link" aria-label="Direct link to DMY與YMD" title="Direct link to DMY與YMD">​</a></h3>
<p>不同國家對於日期格式的使用有不同的使用習慣，1/3是指Mar 1st，還是Jan 3rd真的要處理的對也不容易。</p>
<p>下面這張<a href="https://en.wikipedia.org/wiki/Date_format_by_country" target="_blank" rel="noopener noreferrer">Wiki</a>借來的圖，這些國家使用的日期格式大概分類如下：</p>
<ul>
<li>青色：DMY</li>
<li>黃色：YMD</li>
<li>綠色：混用</li>
</ul>
<p><img loading="lazy" alt="DD" src="https://mechsix.github.io/assets/images/date-format-country-b9807abd5416e7ade7b58478f1e80c3c.png" width="700" height="355" class="img_ev3q"></p>
<p>要能正確格式化這些日期格式，不只是單位換算上，就連顯示格式都可能因地區不同有不同的作法。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="所以要怎麼辦">所以要怎麼辦？<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E6%89%80%E4%BB%A5%E8%A6%81%E6%80%8E%E9%BA%BC%E8%BE%A6" class="hash-link" aria-label="Direct link to 所以要怎麼辦？" title="Direct link to 所以要怎麼辦？">​</a></h2>
<p>問題我們明白了，但是要怎麼辦？有沒有一個準則或做法是能讓我們善加利用別人造好的輪子，但是在我們自己寫的應用程式中卻又能正確操作DateTime的處理？</p>
<p>讓我們來看一下下面這兩個日期時間的表示，他們是相等的嗎？</p>
<ul>
<li>2021-10-13 10:00:00 (UTC+8)</li>
<li>2021-10-13 02:00:00 (UTC+0)</li>
</ul>
<p>作為字串看起來當然不同，但其實是指相同的時間，他們則應該要是相等的。相信看到這裡應該有些頭緒，其實處理日期時間的問題並不那麼複雜，我們只要將其分開成兩個問題看待：</p>
<ul>
<li>怎麼存DateTime<!-- -->
<ul>
<li>存成絕對格式，例如UTC Timezone的timestamp</li>
</ul>
</li>
<li>怎麼顯示DateTime<!-- -->
<ul>
<li>盡可能推遲轉換時間，在接近使用者的呈現層才作序列化(Serialize)</li>
</ul>
</li>
</ul>
<p>若是商業邏輯在處理過程中需要對DateTime進行運算，先把它轉換成具有處理這些複雜問題能力的物件再進行；在要傳遞或顯示出來之前，將DateTime物件序列化(Seralize)成可被對方讀懂的格式</p>
<p>能夠處理這些問題的DateTime物件在各個語言中都存在，例如：</p>
<ul>
<li>Python內建的<a href="https://docs.python.org/3/library/datetime.html" target="_blank" rel="noopener noreferrer">datetime</a>與<a href="http://pytz.sourceforge.net/" target="_blank" rel="noopener noreferrer">pytz</a></li>
<li>PHP的<a href="https://carbon.nesbot.com/docs/" target="_blank" rel="noopener noreferrer">Carbon</a></li>
<li>Javascript自己的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" rel="noopener noreferrer">Date</a>或使用高階一點的工具例如<a href="https://momentjs.com/" target="_blank" rel="noopener noreferrer">Moment</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="序列化與反序列化">序列化與反序列化<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E5%BA%8F%E5%88%97%E5%8C%96%E8%88%87%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96" class="hash-link" aria-label="Direct link to 序列化與反序列化" title="Direct link to 序列化與反序列化">​</a></h3>
<p>而在序列化的格式中，最具權威性的標準就是<a href="https://www.iso.org/iso-8601-date-and-time-format.html" target="_blank" rel="noopener noreferrer">ISO8601</a>，也因為它是一系列的日期格式標準，幾乎能在所有的語言與平台中被正確的處理。在ISO8601中，帶日期時間與時區的表示方法長這樣</p>
<blockquote>
<p>2021-10-13T10:00:00+08:00 <br>
2021-10-13T02:00:00+00:00</p>
</blockquote>
<p>或如果你是UTC時區，你也可以直接將時區改成<code>Z</code></p>
<blockquote>
<p>2021-10-13T02:00:00Z</p>
</blockquote>
<p>而在轉換方面，如果在Javascript內，<code>Date()</code>原生的<code>toISOString()</code>幾乎幫你包辦了這件事。更方便的是，在反序列化時，將字串讀入成為DateTime物件，直接將<code>toISOString()</code>的輸出字串拿回來給<code>new Date()</code>進行反序列化回物件，你其實會拿到一樣的DateTime物件</p>
<p>例如下面這個Demo，同樣的DateTime物件<code>now</code>被序列化成ISOString作為顯示之用；而再度使用<code>Date</code>將他們反序列化回DateTime物件，程式認為他們是相等的：</p>
<div class="playgroundContainer_X_Ta"><div class="playgroundHeader_dyrN">Live Editor</div><div class="playgroundEditor_Q6Y7"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DisplayDateTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setDt</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isoString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setIsoString</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> now </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setDt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setIsoString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toISOString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">clearInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        ISO String: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">isoString</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        DT as timestamp: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        Unseralize still equal: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isoString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'yes'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'no'</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_dyrN">Result</div><div class="playgroundPreview_DzOI"><div>Loading...</div></div></div>
<p>仔細觀察你會發現，這個序列化出來的ISO8601字串是以Z結尾，也就是說他其實是UTC 0的時區在表示你當下的local time，也就是說它其實是帶時區資訊的，瀏覽器處理時是會讀到作業系統所設定的時區。好好掌握這個特性，要在瀏覽器依照使用者的時區來顯示時間，其實是非常方便的。</p>
<p>另外要注意的是，並不是所有的序列化格式，甚至是ISO8601本身，都能夠正確地保留DateTime物件所包含了資訊。在ISO8601的例子中是因為其實ISO8601對於其格式中能保留的訊息精確度是可以選擇的，例如你可以只拿它來表示某個日期，而不是表示到分秒</p>
<p>所以在將DateTime物件序列化成ISO8601時，也得注意是否將訊息的精確度給捨棄了。</p>
<p>而其他的序列化方式，例如在Javascript的<code>toUTCString()</code>，因為他序列化出來的格式沒辦法儲存到毫秒，所以要是你拿它做上面的例子，你會發現反序列化回來的結果會因為秒以下的資訊被捨棄，導致最終反序列化回來的結果不是相等的。</p>
<div class="playgroundContainer_X_Ta"><div class="playgroundHeader_dyrN">Live Editor</div><div class="playgroundEditor_Q6Y7"><pre class="prism-code language-tsx" style="margin:0;outline:none;padding:10px;font-family:inherit;color:#393A34;background-color:#f6f8fa" spellcheck="false"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DisplayDateTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setDt</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">utcString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setUtcString</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> now </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setDt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setUtcString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toUTCString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">clearInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34">
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        UTC String: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">utcString</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        DT to timestamp: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">br</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        UTC String Unseralize Timestamp: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">utcString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">        Unseralize still equal: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">utcString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'yes'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'no'</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span>
</span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span>
</span></pre></div><div class="playgroundHeader_dyrN">Result</div><div class="playgroundPreview_DzOI"><div>Loading...</div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="兩種情境">兩種情境<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E5%85%A9%E7%A8%AE%E6%83%85%E5%A2%83" class="hash-link" aria-label="Direct link to 兩種情境" title="Direct link to 兩種情境">​</a></h2>
<p>在繼續討論前，有必要提一下SSoT (Single Source of Truth)的概念。資料在不同的process與不同的機器間傳遞，過程中因為格式轉換、傳輸延遲、避免被篡改的安全考量、甚至是錯誤的實作(Bug)，都有可能導致同一份資料在不同的時間或地方而有不同的值</p>
<p>舉例來說，前端的14:00，在後端因為時區不同或是主機的時間校正有問題有可能是13:01</p>
<p><strong>SSoT的概念指的是：到底哪一份資料是最具權威性的？在資料有差異的時候可以以它為準？</strong></p>
<p>要能夠正確的處理DateTime，識別哪一份資料是SSoT是最重要的一個步驟</p>
<p>舉例來說，以3-tier的Web Application為例子，三個最主要產生資料落差的SSoT候選人就是那三個tier。</p>
<ol>
<li>Frontend</li>
<li>Backend</li>
<li>Database</li>
</ol>
<p>在不同的情境下，SSoT可能會在不同的地方，以下就建立與查詢的情境進行討論</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="建立的情境">建立的情境<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E5%BB%BA%E7%AB%8B%E7%9A%84%E6%83%85%E5%A2%83" class="hash-link" aria-label="Direct link to 建立的情境" title="Direct link to 建立的情境">​</a></h3>
<p>在建立資料的情境，例如說前端按下submit，後端收到請求後往資料庫建立資料，這筆資料的Create Time的SSoT會是以誰為基準？</p>
<p>前端可以先排除，畢竟前端的立場是『送出請求』，加上來自前端的資料可能被篡改並不可信，並沒辦法作為SSoT</p>
<p>後端以接收到請求的時間為準，看起來是個選項</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查詢的情境">查詢的情境<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#%E6%9F%A5%E8%A9%A2%E7%9A%84%E6%83%85%E5%A2%83" class="hash-link" aria-label="Direct link to 查詢的情境" title="Direct link to 查詢的情境">​</a></h3>
<p>使用者在前端送出"查詢的條件"，被查詢的資料則是以資料庫內的為準</p>
<p>也就是說，查詢的SSoT來自前端；回應的資料SSoT是資料庫</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frontend">Frontend<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#frontend" class="hash-link" aria-label="Direct link to Frontend" title="Direct link to Frontend">​</a></h2>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'2021-01-01'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creation--query">Creation &amp; Query<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#creation--query" class="hash-link" aria-label="Direct link to Creation &amp; Query" title="Direct link to Creation &amp; Query">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scenarios">Scenarios<a href="https://mechsix.github.io/blog/%E4%B8%80%E5%A4%A924%E5%B0%8F%E6%99%82%EF%BC%9F%E8%AB%87DateTime%E8%99%95%E7%90%86#scenarios" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios">​</a></h3>
<ul>
<li>Created At</li>
<li>Received At</li>
<li>Query between</li>
</ul>]]></content>
        <author>
            <name>Mech Tsai</name>
            <uri>https://mech.run</uri>
        </author>
        <category label="Develop Practice" term="Develop Practice"/>
    </entry>
</feed>